<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>MAITRI Voice-Only Test</title>
  <style>
    body { background:#111; color:#eee; font-family:sans-serif; display:flex;
           flex-direction:column;align-items:center;padding:20px }
    #chat { width:100%;max-width:600px;height:300px;overflow:auto;
            background:#222;padding:10px;border-radius:8px }
    #chat div { margin:6px 0 }
    .user { color:#6f6 }
    .ai   { color:#6cf }
    #input { width:70%;padding:8px;border-radius:4px;border:none }
    button { padding:8px 12px;margin-left:6px;border:none;
             border-radius:4px;background:#28a;color:#fff;cursor:pointer }
    .listening { background:#4a4 }
  </style>
</head>
<body>

  <h1>MAITRI Voice-Only Test</h1>
  <div id="chat"></div>
  <div style="margin-top:10px">
    <input id="input" placeholder="Type messageâ€¦"/>
    <button id="send">âž¤</button>
    <button id="voice">ðŸŽ¤</button>
  </div>

  <script>
    const API_KEY = "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";  // â† insert your API key

    // Chat UI
    const chat = document.getElementById('chat');
    function add(who,text){
      const d=document.createElement('div');
      d.className = who==='You'?'user':'ai';
      d.textContent = (who?who+': ':'')+text;
      chat.appendChild(d);
      chat.scrollTop = chat.scrollHeight;
    }

    // Text-to-speech
    function speak(txt){
      const u=new SpeechSynthesisUtterance(txt);
      u.rate=0.9;u.pitch=1;speechSynthesis.speak(u);
    }

    // Voice recognition
    const rec=new (window.SpeechRecognition||window.webkitSpeechRecognition)();
    rec.lang='en-US';
    rec.onresult=e=>{
      const txt=e.results[0][0].transcript;
      add('You',txt);
      sendToAI(txt);
      voiceBtn.classList.remove('listening');
    };
    rec.onerror=_=>voiceBtn.classList.remove('listening');

    const voiceBtn=document.getElementById('voice');
    voiceBtn.onclick=()=>{
      if(voiceBtn.classList.toggle('listening')) rec.start();
      else rec.stop();
    };

    // Send button / text input
    document.getElementById('send').onclick=()=>{
      const inp=document.getElementById('input');
      const msg=inp.value.trim(); if(!msg) return;
      add('You',msg);
      inp.value='';
      sendToAI(msg);
    };

    // AI call
    async function sendToAI(msg) {
      add('MAITRI', 'â€¦thinkingâ€¦');
      try {
        const res = await fetch('https://api.groq.com/openai/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${API_KEY}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            model: 'llama-3.3-70b-versatile',
            messages: [
              { role: 'system', content: 'You are MAITRI, an empathetic AI counselor for astronauts.' },
              { role: 'user', content: msg }
            ],
            temperature: 0.7,
            max_tokens: 200
          })
        });
        const j = await res.json();
        chat.lastChild.remove();
        const reply = (j.choices && j.choices[0] && j.choices[0].message && j.choices[0].message.content) 
                      ? j.choices[0].message.content 
                      : 'No response';
        add('MAITRI', reply);
        speak(reply);
      } catch(e) {
        chat.lastChild.remove();
        add('MAITRI', 'Error contacting API');
        console.error(e);
      }
    }

    // Initial greeting
    add('MAITRI','Hello! This is a voice-only test. Click ðŸŽ¤ or type below.');
  </script>
</body>
</html>
